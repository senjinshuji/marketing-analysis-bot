# スクレイピング精度の改善

## 実装内容

### 1. 包括的スクレイパー (`lib/scraper-comprehensive.ts`)

実際のLPからすべての情報を取得する高精度スクレイパー：

#### 取得する情報
- **価格情報**（最重要）
  - 初回限定価格（初回980円など）
  - 通常価格
  - 定期購入価格
  - キャンペーン情報
  
- **商品情報**
  - 商品名（正式名称）
  - カテゴリー
  - 特徴・機能
  - 効果・効能
  - 成分・原材料
  
- **販売情報**
  - 会社名
  - キャンペーン詳細
  - 返金保証
  
- **信頼性情報**
  - 権威性（医師監修など）
  - お客様の声の数
  - 受賞歴・ランキング

### 2. Edge Function強化版 (`/api/comprehensive-scrape`)

複数のフェッチ戦略を試行：
1. 標準ヘッダー（Chrome エミュレーション）
2. モバイルUA
3. cURLエミュレーション
4. GoogleBotエミュレーション

### 3. GPTプロンプトの改善

スクレイピングデータを明示的に使用するよう指示：
- 推測や一般的な例を使わない
- 実際のLPデータのみを使用
- 価格情報は必ずスクレイピングデータから

## 価格検出の仕組み

### パターンマッチング
```javascript
// 初回限定価格（最優先）
/初回限定[\s：:]*([¥￥]?[\d,]+)\s*円/g
/初回特別価格[\s：:]*([¥￥]?[\d,]+)\s*円/g

// お試し価格
/お試し価格[\s：:]*([¥￥]?[\d,]+)\s*円/g
/トライアル価格[\s：:]*([¥￥]?[\d,]+)\s*円/g

// 通常価格
/通常価格[\s：:]*([¥￥]?[\d,]+)\s*円/g
/定価[\s：:]*([¥￥]?[\d,]+)\s*円/g
```

### 優先度システム
1. 初回限定価格（優先度: 100）
2. お試し・トライアル価格（優先度: 90）
3. キャンペーン価格（優先度: 80）
4. 定期価格（優先度: 70）
5. 通常価格（優先度: 50）

## 改善効果

### Before
- GPTが価格を推測（例：健康食品→980円）
- LPの実際のデータを使用しない
- 分析精度が低い

### After
- LPから実際の価格を抽出
- すべての情報をスクレイピング
- GPTは実データのみを使用

## テスト例

```
URL: https://example-supplement.jp/lp

スクレイピング結果:
- 商品名: エクサンプルサプリ
- 初回価格: 初回限定1,480円（通常価格4,980円の70%OFF）
- 特徴: 
  - 管理栄養士監修
  - 30日間返金保証
  - GMP認定工場で製造
- 権威性: 医師監修、モンドセレクション金賞

GPT分析:
→ 上記の実データのみを使用して分析
```